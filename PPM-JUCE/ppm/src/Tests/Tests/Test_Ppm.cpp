#include "MUSI6106Config.h"

#ifdef WITH_TESTS
#include <cassert>

#include "UnitTest++.h"
#include "Ppm.h"
#include "Vector.h"
#include "Synthesis.h"

SUITE(Ppm)
{
    struct PpmData
    {
        PpmData() : m_iNumberOfChannels(2),
                    m_iNumFrames(1024),
                    m_bIsInitialized(false),
                    m_fAlphaAT(0),
                    m_fAttackTime(0.01),
                    m_fAlphaRT(0),
                    m_fReleaseTime(1.5),
                    m_ppfInputBuffer(0),
                    m_fSampleRateHz(16000.0)
        
        {
            m_pCPpm     = new CPpm ();
            m_ppfInputBuffer   = new float*[m_iNumberOfChannels];
            for (int c=0;c<m_iNumberOfChannels; c++){
                m_ppfInputBuffer[c] = new float[m_iNumFrames]();
            }
            m_pfLastPpm = new float[m_iNumberOfChannels]();
            m_fAlphaAT = 1.0f - exp(-2.2f / (m_fSampleRateHz*m_fAttackTime));
            m_fAlphaRT = 1.0f - exp(-2.2f / (m_fSampleRateHz*m_fReleaseTime));
            m_bIsInitialized = true;
        }
        
        ~PpmData()
        {
            delete m_pCPpm;
            for (int c=0;c < m_iNumberOfChannels; c++){
                delete m_ppfInputBuffer[c];
            }
            
            delete [] m_pfLastPpm;
            delete [] m_ppfInputBuffer;
            m_bIsInitialized = false;
        }
        
        
        CPpm *m_pCPpm;
        float m_fSampleRateHz;
        int m_iNumberOfChannels;
        int m_iNumFrames;
        
        float m_fAlphaAT;
        float m_fAlphaRT;
        
        float m_fAttackTime;
        float m_fReleaseTime;
        
        float m_fMaxPpm;
        float* m_pfLastPpm;
        
        float **m_ppfInputBuffer;
        
        bool m_bIsInitialized;
        
    };
    
    TEST_FIXTURE(PpmData, Api)
    {
        CHECK_EQUAL(kFunctionInvalidArgsError, m_pCPpm->init(-1,4, -8, 0));
        CHECK_EQUAL(kNotInitializedError, m_pCPpm->process((const float**)m_ppfInputBuffer, m_iNumFrames));
        CHECK_EQUAL(kFunctionInvalidArgsError, m_pCPpm->init(3,0, 0,0));
        
    }
    
    TEST_FIXTURE(PpmData, SineInput)
    {
        float SineBuff[] = {0.0142471037071031,0.0284913153908450,0.0427297436149168,0.0569594981169959,0.0711776903954407,0.0853814342956285,0.0995678465958167,0.113734047592409,0.127877161684506,0.141994317957627,0.156082650766474,0.170139300316633,0.184161413245082,0.198146143199398,0.212090651415537,0.225992107294077,0.239847688974801,0.253654583909507,0.267409989432931,0.281111113331655,0.294755174410904,0.308339403059100,0.321861041810066,0.335317345902764,0.348705583838457,0.362023037935174,0.375267004879374,0.388434796274695,0.401523739187667,0.414531176690295,0.427454468399392,0.440290991012542,0.453038138840617,0.465693324336696,0.478253978621318,0.490717552003938,0.503081514500488,0.515343356346940,0.527500588508765,0.539550743186181,0.551491374315094,0.563320058063622,0.575034393324113,0.586632002200546,0.598110530491216,0.609467648166622,0.620701049842432,0.631808455247461,0.642787609686539,0.653636284498194,0.664352277507046,0.674933413470833,0.685377544521957,0.695682550603487,0.705846339899502,0.715866849259718,0.725742044618282,0.735469921406667,0.745048504960584,0.754475850920815,0.763750045627902,0.772869206510603,0.781831482468030,0.790635054245408,0.799278134803368,0.807758969680692,0.816075837350461,0.824227049569498,0.832210951721074,0.840025923150772,0.847670377495468,0.855142763005346,0.862441562858891,0.869565295470782,0.876512514792648,0.883281810606594,0.889871808811469,0.896281171701787,0.902508598239275,0.908552824316969,0.914412623015813,0.920086804853714,0.925574218026997,0.930873748644204,0.935984320952211,0.940904897554589,0.945634479622187,0.950172107095887,0.954516858881484,0.958667853036661,0.962624246950012,0.966385237512088,0.969950061278417,0.973317994624476,0.976488353892582,0.979460495530667,0.982233816222910,0.984807753012208,0.987181783414450,0.989355425524575,0.991328238114393,0.993099820722155,0.994669813733835,0.996037898456137,0.997203797181180,0.998167273242872,0.998928131064952,0.999486216200688,0.999841415364231,0.999993656453608,0.999942908565361,0.999689182000816,0.999232528263997,0.998573040051166,0.997710851232010,0.996646136822468,0.995379112949198,0.993910036805714,0.992239206600172,0.990366961494838,0.988293681537243,0.986019787583036,0.983545741210553,0.980872044627124,0.977999240567128,0.974927912181824,0.971658682920974,0.968192216406295,0.964529216296742,0.960670426145682,0.956616629249949,0.952368648490852,0.947927346167132,0.943293623819925,0.938468422049760,0.933452720325625,0.928247536786144,0.922853928032904,0.917272988915976,0.911505852311673,0.905553688892585,0.899417706889941,0.893099151848358,0.886599306373000,0.879919489869224,0.873061058274753,0.866025403784439,0.858813954567650,0.851428174478379,0.843869562758083,0.836139653731363,0.828240016494500,0.820172254596956,0.811938005715856,0.803538941323567,0.794976766348398,0.786253218828517,0.777370069559152,0.768329121733128,0.759132210574843,0.749781202967734,0.740277997075316,0.730624521955873,0.720822737170881,0.710874632387235,0.700782226973364,0.690547569589319,0.680172737770919,0.669659837508028,0.659011002817058,0.648228395307788,0.637314203744579,0.626270643602069,0.615099956615464,0.603804410325477,0.592386297618048,0.580847936258903,0.569191668423076,0.557419860219468,0.545534901210549,0.533539203927301,0.521435203379498,0.509225356561423,0.496912141953121,0.484498059017291,0.471985627691923,0.459377387878771,0.446675898927778,0.433883739117559,0.421003505132024,0.408037811533290,0.394989290230939,0.381860589947772,0.368654375682143,0.355373328166989,0.342020143325669,0.328597531724716,0.315108218023620,0.301554940421750,0.287940450102519,0.274267510674931,0.260538897612586,0.246757397690294,0.232925808418379,0.219046937474817,0.205123602135303,0.191158628701373,0.177154851926687,0.163115114441608,0.149042266176175,0.134939163781588,0.120808670050347,0.106653653335120,0.0924769869665081,0.0782815486697771,0.0640702199807132,0.0498458856606975,0.0356114331111268,0.0213697517873019,0.00712373261189136,-0.00712373261189111,-0.0213697517873016,-0.0356114331111265,-0.0498458856606972,-0.0640702199807126,-0.0782815486697768,-0.0924769869665075,-0.106653653335120,-0.120808670050346,-0.134939163781588,-0.149042266176174,-0.163115114441608,-0.177154851926686,-0.191158628701372,-0.205123602135303,-0.219046937474816,-0.232925808418379,-0.246757397690294,-0.260538897612586,-0.274267510674930,-0.287940450102519,-0.301554940421750,-0.315108218023620,-0.328597531724716,-0.342020143325668,-0.355373328166989,-0.368654375682142,-0.381860589947772,-0.394989290230939,-0.408037811533290,-0.421003505132024,-0.433883739117558,-0.446675898927778,-0.459377387878770,-0.471985627691923,-0.484498059017292,-0.496912141953121,-0.509225356561423,-0.521435203379498,-0.533539203927301,-0.545534901210549,-0.557419860219468,-0.569191668423076,-0.580847936258903,-0.592386297618048,-0.603804410325477,-0.615099956615464,-0.626270643602069,-0.637314203744579,-0.648228395307788,-0.659011002817058,-0.669659837508028,-0.680172737770919,-0.690547569589319,-0.700782226973363,-0.710874632387235,-0.720822737170881,-0.730624521955873,-0.740277997075315,-0.749781202967734,-0.759132210574843,-0.768329121733128,-0.777370069559152,-0.786253218828518,-0.794976766348398,-0.803538941323567,-0.811938005715857,-0.820172254596956,-0.828240016494501,-0.836139653731362,-0.843869562758083,-0.851428174478379,-0.858813954567650,-0.866025403784439,-0.873061058274754,-0.879919489869224,-0.886599306373000,-0.893099151848358,-0.899417706889941,-0.905553688892584,-0.911505852311673,-0.917272988915976,-0.922853928032904,-0.928247536786144,-0.933452720325626,-0.938468422049761,-0.943293623819925,-0.947927346167132,-0.952368648490852,-0.956616629249949,-0.960670426145682,-0.964529216296743,-0.968192216406295,-0.971658682920974,-0.974927912181824,-0.977999240567128,-0.980872044627124,-0.983545741210553,-0.986019787583036,-0.988293681537243,-0.990366961494838,-0.992239206600172,-0.993910036805714,-0.995379112949198,-0.996646136822468,-0.997710851232010,-0.998573040051166,-0.999232528263997,-0.999689182000816,-0.999942908565361,-0.999993656453608,-0.999841415364231,-0.999486216200688,-0.998928131064952,-0.998167273242872,-0.997203797181180,-0.996037898456137,-0.994669813733835,-0.993099820722155,-0.991328238114393,-0.989355425524575,-0.987181783414450,-0.984807753012208,-0.982233816222910,-0.979460495530667,-0.976488353892582,-0.973317994624476,-0.969950061278417,-0.966385237512088,-0.962624246950012,-0.958667853036661,-0.954516858881484,-0.950172107095887,-0.945634479622187,-0.940904897554589,-0.935984320952211,-0.930873748644204,-0.925574218026997,-0.920086804853714,-0.914412623015812,-0.908552824316969,-0.902508598239275,-0.896281171701787,-0.889871808811468,-0.883281810606594,-0.876512514792648,-0.869565295470782,-0.862441562858890,-0.855142763005346,-0.847670377495468,-0.840025923150771,-0.832210951721073,-0.824227049569498,-0.816075837350461,-0.807758969680692,-0.799278134803367,-0.790635054245408,-0.781831482468029,-0.772869206510603,-0.763750045627902,-0.754475850920814,-0.745048504960583,-0.735469921406666,-0.725742044618282,-0.715866849259718,-0.705846339899502,-0.695682550603486,-0.685377544521957,-0.674933413470833,-0.664352277507046,-0.653636284498193,-0.642787609686540,-0.631808455247461,-0.620701049842432,-0.609467648166621,-0.598110530491216,-0.586632002200546,-0.575034393324113,-0.563320058063621,-0.551491374315093,-0.539550743186181,-0.527500588508765,-0.515343356346940,-0.503081514500487,-0.490717552003937,-0.478253978621318,-0.465693324336696,-0.453038138840617,-0.440290991012542,-0.427454468399390,-0.414531176690295,-0.401523739187666,-0.388434796274694,-0.375267004879375,-0.362023037935174,-0.348705583838457,-0.335317345902764,-0.321861041810066,-0.308339403059100,-0.294755174410904,-0.281111113331654,-0.267409989432931,-0.253654583909507,-0.239847688974800,-0.225992107294076,-0.212090651415536,-0.198146143199397,-0.184161413245081,-0.170139300316633,-0.156082650766474,-0.141994317957626,-0.127877161684505,-0.113734047592409,-0.0995678465958164,-0.0853814342956278,-0.0711776903954396,-0.0569594981169961,-0.0427297436149166,-0.0284913153908443,-0.0142471037071020,-2.44929359829471e-16,0.0142471037071033,0.0284913153908456,0.0427297436149170,0.0569594981169965,0.0711776903954409,0.0853814342956291,0.0995678465958168,0.113734047592409,0.127877161684507,0.141994317957627,0.156082650766474,0.170139300316633,0.184161413245083,0.198146143199399,0.212090651415537,0.225992107294077,0.239847688974802,0.253654583909507,0.267409989432931,0.281111113331656,0.294755174410905,0.308339403059101,0.321861041810066,0.335317345902765,0.348705583838458,0.362023037935174,0.375267004879374,0.388434796274695,0.401523739187667,0.414531176690296,0.427454468399392,0.440290991012543,0.453038138840617,0.465693324336696,0.478253978621319,0.490717552003939,0.503081514500487,0.515343356346940,0.527500588508766,0.539550743186182,0.551491374315094,0.563320058063622,0.575034393324114,0.586632002200546,0.598110530491216,0.609467648166622,0.620701049842433,0.631808455247462,0.642787609686540,0.653636284498194,0.664352277507047,0.674933413470833,0.685377544521958,0.695682550603487,0.705846339899503,0.715866849259719,0.725742044618283,0.735469921406668,0.745048504960583,0.754475850920815,0.763750045627903,0.772869206510604,0.781831482468030,0.790635054245408,0.799278134803368,0.807758969680693,0.816075837350461,0.824227049569498,0.832210951721074,0.840025923150772,0.847670377495468,0.855142763005346,0.862441562858891,0.869565295470782,0.876512514792648,0.883281810606595,0.889871808811469,0.896281171701787,0.902508598239275,0.908552824316969,0.914412623015813,0.920086804853714,0.925574218026997,0.930873748644205,0.935984320952212,0.940904897554589,0.945634479622187,0.950172107095887,0.954516858881484,0.958667853036661,0.962624246950012,0.966385237512088,0.969950061278417,0.973317994624476,0.976488353892582,0.979460495530667,0.982233816222910,0.984807753012208,0.987181783414450,0.989355425524575,0.991328238114393,0.993099820722155,0.994669813733836,0.996037898456137,0.997203797181180,0.998167273242872,0.998928131064952,0.999486216200688,0.999841415364231,0.999993656453608,0.999942908565361,0.999689182000816,0.999232528263997,0.998573040051166,0.997710851232010,0.996646136822468,0.995379112949198,0.993910036805714,0.992239206600172,0.990366961494838,0.988293681537243,0.986019787583035,0.983545741210553,0.980872044627124,0.977999240567128,0.974927912181823,0.971658682920974,0.968192216406294,0.964529216296742,0.960670426145682,0.956616629249949,0.952368648490852,0.947927346167132,0.943293623819925,0.938468422049760,0.933452720325625,0.928247536786144,0.922853928032904,0.917272988915976,0.911505852311673,0.905553688892584,0.899417706889941,0.893099151848358,0.886599306373000,0.879919489869224,0.873061058274754,0.866025403784438,0.858813954567650,0.851428174478379,0.843869562758084,0.836139653731362,0.828240016494500,0.820172254596956,0.811938005715856,0.803538941323567,0.794976766348398,0.786253218828517,0.777370069559151,0.768329121733127,0.759132210574843,0.749781202967734,0.740277997075315,0.730624521955872,0.720822737170881,0.710874632387235,0.700782226973363,0.690547569589319,0.680172737770919,0.669659837508028,0.659011002817057,0.648228395307788,0.637314203744579,0.626270643602070,0.615099956615463,0.603804410325477,0.592386297618048,0.580847936258902,0.569191668423075,0.557419860219467,0.545534901210549,0.533539203927300,0.521435203379497,0.509225356561423,0.496912141953121,0.484498059017290,0.471985627691924,0.459377387878770,0.446675898927778,0.433883739117557,0.421003505132025,0.408037811533289,0.394989290230939,0.381860589947770,0.368654375682142,0.355373328166988,0.342020143325669,0.328597531724715,0.315108218023620,0.301554940421749,0.287940450102519,0.274267510674931,0.260538897612585,0.246757397690293,0.232925808418377,0.219046937474817,0.205123602135302,0.191158628701372,0.177154851926685,0.163115114441609,0.149042266176174,0.134939163781588,0.120808670050345,0.106653653335121,0.0924769869665071,0.0782815486697765,0.0640702199807130,0.0498458856606977,0.0356114331111261,0.0213697517873012,0.00712373261189160,-0.00712373261189265,-0.0213697517873023,-0.0356114331111272,-0.0498458856606970,-0.0640702199807141,-0.0782815486697775,-0.0924769869665081,-0.106653653335120,-0.120808670050348,-0.134939163781589,-0.149042266176175,-0.163115114441608,-0.177154851926687,-0.191158628701373,-0.205123602135303,-0.219046937474817,-0.232925808418380,-0.246757397690294,-0.260538897612586,-0.274267510674930,-0.287940450102520,-0.301554940421750,-0.315108218023621,-0.328597531724717,-0.342020143325670,-0.355373328166989,-0.368654375682143,-0.381860589947773,-0.394989290230940,-0.408037811533290,-0.421003505132024,-0.433883739117556,-0.446675898927777,-0.459377387878769,-0.471985627691923,-0.484498059017291,-0.496912141953120,-0.509225356561424,-0.521435203379498,-0.533539203927300,-0.545534901210549,-0.557419860219467,-0.569191668423075,-0.580847936258902,-0.592386297618047,-0.603804410325478,-0.615099956615464,-0.626270643602069,-0.637314203744579,-0.648228395307787,-0.659011002817056,-0.669659837508027,-0.680172737770919,-0.690547569589318,-0.700782226973363,-0.710874632387235,-0.720822737170882,-0.730624521955873,-0.740277997075314,-0.749781202967734,-0.759132210574843,-0.768329121733127,-0.777370069559152,-0.786253218828517,-0.794976766348398,-0.803538941323568,-0.811938005715856,-0.820172254596957,-0.828240016494500,-0.836139653731362,-0.843869562758083,-0.851428174478378,-0.858813954567650,-0.866025403784439,-0.873061058274753,-0.879919489869224,-0.886599306373000,-0.893099151848358,-0.899417706889941,-0.905553688892584,-0.911505852311673,-0.917272988915976,-0.922853928032904,-0.928247536786144,-0.933452720325626,-0.938468422049760,-0.943293623819925,-0.947927346167132,-0.952368648490852,-0.956616629249949,-0.960670426145682,-0.964529216296742,-0.968192216406295,-0.971658682920974,-0.974927912181823,-0.977999240567128,-0.980872044627124,-0.983545741210553,-0.986019787583036,-0.988293681537243,-0.990366961494838,-0.992239206600172,-0.993910036805714,-0.995379112949198,-0.996646136822467,-0.997710851232010,-0.998573040051166,-0.999232528263997,-0.999689182000816,-0.999942908565361,-0.999993656453608,-0.999841415364231,-0.999486216200688,-0.998928131064952,-0.998167273242872,-0.997203797181180,-0.996037898456137,-0.994669813733835,-0.993099820722155,-0.991328238114393,-0.989355425524575,-0.987181783414450,-0.984807753012208,-0.982233816222910,-0.979460495530667,-0.976488353892582,-0.973317994624476,-0.969950061278417,-0.966385237512088,-0.962624246950013,-0.958667853036660,-0.954516858881484,-0.950172107095887,-0.945634479622187,-0.940904897554589,-0.935984320952211,-0.930873748644204,-0.925574218026997,-0.920086804853714,-0.914412623015813,-0.908552824316969,-0.902508598239275,-0.896281171701787,-0.889871808811469,-0.883281810606594,-0.876512514792648,-0.869565295470782,-0.862441562858890,-0.855142763005347,-0.847670377495468,-0.840025923150772,-0.832210951721075,-0.824227049569498,-0.816075837350461,-0.807758969680693,-0.799278134803367,-0.790635054245409,-0.781831482468029,-0.772869206510604,-0.763750045627903,-0.754475850920815,-0.745048504960584,-0.735469921406668,-0.725742044618282,-0.715866849259718,-0.705846339899504,-0.695682550603487,-0.685377544521958,-0.674933413470833,-0.664352277507046,-0.653636284498194,-0.642787609686539,-0.631808455247461,-0.620701049842433,-0.609467648166621,-0.598110530491217,-0.586632002200546,-0.575034393324114,-0.563320058063623,-0.551491374315094,-0.539550743186181,-0.527500588508765,-0.515343356346939,-0.503081514500489,-0.490717552003940,-0.478253978621319,-0.465693324336697,-0.453038138840617,-0.440290991012543,-0.427454468399392,-0.414531176690295,-0.401523739187666,-0.388434796274697,-0.375267004879375,-0.362023037935175,-0.348705583838459,-0.335317345902765,-0.321861041810067,-0.308339403059100,-0.294755174410904,-0.281111113331655,-0.267409989432930,-0.253654583909509,-0.239847688974802,-0.225992107294077,-0.212090651415537,-0.198146143199397,-0.184161413245082,-0.170139300316633,-0.156082650766473,-0.141994317957626,-0.127877161684508,-0.113734047592409,-0.0995678465958175,-0.0853814342956298,-0.0711776903954407,-0.0569594981169963,-0.0427297436149159,-0.0284913153908446,-0.0142471037071049,-4.89858719658941e-16,0.0142471037071022,0.0284913153908436,0.0427297436149167,0.0569594981169954,0.0711776903954397,0.0853814342956288,0.0995678465958166,0.113734047592410,0.127877161684505,0.141994317957625,0.156082650766474,0.170139300316632,0.184161413245081,0.198146143199398,0.212090651415537,0.225992107294074,0.239847688974801,0.253654583909506,0.267409989432931,0.281111113331654,0.294755174410903,0.308339403059101,0.321861041810066,0.335317345902764,0.348705583838458,0.362023037935172,0.375267004879374,0.388434796274694,0.401523739187666,0.414531176690296,0.427454468399391,0.440290991012542,0.453038138840618,0.465693324336696,0.478253978621316,0.490717552003937,0.503081514500486,0.515343356346940,0.527500588508765,0.539550743186181,0.551491374315094,0.563320058063622,0.575034393324112,0.586632002200546,0.598110530491215,0.609467648166620,0.620701049842432,0.631808455247461,0.642787609686540,0.653636284498194,0.664352277507046,0.674933413470833,0.685377544521956,0.695682550603485,0.705846339899502,0.715866849259718,0.725742044618282,0.735469921406667,0.745048504960583,0.754475850920815,0.763750045627903,0.772869206510602,0.781831482468030,0.790635054245408,0.799278134803367,0.807758969680692,0.816075837350461,0.824227049569499,0.832210951721074,0.840025923150771,0.847670377495468,0.855142763005346,0.862441562858890,0.869565295470782,0.876512514792648,0.883281810606594,0.889871808811469,0.896281171701787,0.902508598239276,0.908552824316968,0.914412623015812,0.920086804853714,0.925574218026996,0.930873748644204,0.935984320952211,0.940904897554589,0.945634479622187,0.950172107095887,0.954516858881483,0.958667853036661,0.962624246950012,0.966385237512088,0.969950061278417,0.973317994624476,0.976488353892582,0.979460495530667,0.982233816222910,0.984807753012208,0.987181783414450,0.989355425524575,0.991328238114393,0.993099820722155,0.994669813733835,0.996037898456137,0.997203797181180,0.998167273242872,0.998928131064952,0.999486216200688,0.999841415364231,0.999993656453608,0.999942908565361,0.999689182000816,0.999232528263997,0.998573040051166,0.997710851232010,0.996646136822468,0.995379112949198,0.993910036805714,0.992239206600172,0.990366961494838,0.988293681537243,0.986019787583036,0.983545741210553,0.980872044627124,0.977999240567129,0.974927912181824,0.971658682920974,0.968192216406294,0.964529216296743,0.960670426145682,0.956616629249949,0.952368648490852,0.947927346167132,0.943293623819925,0.938468422049761,0.933452720325626,0.928247536786144,0.922853928032904,0.917272988915976,0.911505852311673,0.905553688892585,0.899417706889941};

        for (int c = 0; c < m_iNumberOfChannels; c++){
            for(int f=0; f<m_iNumFrames; f++){
                m_ppfInputBuffer[c][f] = SineBuff[f];
            }
        }
        
        m_pCPpm->init(m_fSampleRateHz, m_iNumberOfChannels, m_fAttackTime, m_fReleaseTime);
        m_pCPpm->process((const float**)m_ppfInputBuffer, m_iNumFrames);
        
        CHECK_CLOSE(0.9542F, m_pCPpm->getMaxPpm(), 0.05);
    }
    
    TEST_FIXTURE(PpmData, RectInput)
    {
        for (int c = 0; c < m_iNumberOfChannels; c++){
            for(int f =0; f<m_iNumFrames; f++){
                if (f%6<3)
                    m_ppfInputBuffer[c][f] = 1;
                else
                    m_ppfInputBuffer[c][f] = -1;
            }
        }
        
        m_pCPpm->init(m_fSampleRateHz, m_iNumberOfChannels, m_fAttackTime, m_fReleaseTime);
        m_pCPpm->process((const float**)m_ppfInputBuffer, m_iNumFrames);
        
        CHECK_CLOSE(1, m_pCPpm->getMaxPpm(), 0.01);
        
    }
    
   
    TEST_FIXTURE(PpmData, ZeroInput)
    {
        m_pCPpm->init(m_fSampleRateHz, m_iNumberOfChannels, m_fAttackTime, m_fReleaseTime);
        m_pCPpm->process((const float**)m_ppfInputBuffer, m_iNumFrames);
        CHECK_EQUAL(0.F, m_pCPpm->getMaxPpm());
    }

    TEST_FIXTURE(PpmData, DCInput)
    {
       
    
        for (int c = 0; c < m_iNumberOfChannels; c++)
        {
           CSynthesis::generateDc(m_ppfInputBuffer[c], m_iNumFrames, 1.F);
        }
        
        
        m_pCPpm->init(m_fSampleRateHz, m_iNumberOfChannels, m_fAttackTime, m_fReleaseTime);
        m_pCPpm->process((const float**)m_ppfInputBuffer, m_iNumFrames);
        
        CHECK_CLOSE(1.F, m_pCPpm->getMaxPpm(), 0.0001);
        
    }

    TEST_FIXTURE(PpmData, AudioInput)
    {
        float fAudioBuff[] = {0.0884399414062500, 0.0414428710937500, -0.0162658691406250, -0.0603637695312500, -0.0836181640625000, -0.0824890136718750, -0.0520019531250000, -0.0146484375000000, 0.0166931152343750, 0.0293579101562500, 0.0186767578125000, 0.0102539062500000, 0.0195617675781250, 0.0461425781250000, 0.0695495605468750, 0.0716857910156250, 0.0475158691406250, 0, -0.0495605468750000, -0.0899353027343750, -0.100433349609375, -0.0756225585937500, -0.0374755859375000, -0.0107727050781250, -0.00888061523437500, -0.0149841308593750, -0.0246582031250000, -0.0303344726562500, -0.0354614257812500, -0.0502014160156250, -0.0674133300781250, -0.0496520996093750, 0.00854492187500000, 0.0554199218750000, 0.0904541015625000, 0.135864257812500, 0.175537109375000, 0.156494140625000, 0.0487060546875000, -0.104797363281250, -0.208190917968750, -0.223449707031250, -0.171875000000000, -0.0927124023437500, -0.00952148437500000, 0.0516662597656250, 0.0635681152343750, 0.0381469726562500, -0.0108947753906250, -0.0212402343750000, 0.0289611816406250, 0.119079589843750, 0.187683105468750, 0.182006835937500, 0.122619628906250, 0.0265808105468750, -0.0617370605468750, -0.125946044921875, -0.149414062500000, -0.120941162109375, -0.0731506347656250, -0.0402832031250000, -0.0285949707031250, -0.0135498046875000, 0.0183715820312500, 0.0657958984375000, 0.111083984375000, 0.131286621093750, 0.128417968750000, 0.106628417968750, 0.0619506835937500, 0.00640869140625000, -0.0387878417968750, -0.0489196777343750, -0.0316162109375000, -0.00363159179687500, 0.00952148437500000, -0.000976562500000000, -0.0159301757812500, -0.0318603515625000, -0.0412597656250000, -0.0385742187500000, -0.0138854980468750, 0.0254211425781250, 0.0681762695312500, 0.0928039550781250, 0.0894165039062500, 0.0697326660156250, 0.0403747558593750, 0.0112304687500000, -0.0158081054687500, -0.0284423828125000, -0.0156860351562500, 0.00961303710937500, 0.0317077636718750, 0.0254211425781250, 0.000427246093750000, -0.0247802734375000, -0.0446472167968750, -0.0591735839843750, -0.0650634765625000, -0.0429382324218750, -0.00201416015625000, 0.0384521484375000, 0.0589599609375000, 0.0504455566406250, 0.0373840332031250, 0.0317382812500000, 0.0361022949218750, 0.0340576171875000, 0.0243530273437500, 0.0105590820312500, -0.0153808593750000, -0.0476379394531250, -0.0830993652343750, -0.0938110351562500, -0.0754394531250000, -0.0420532226562500, -0.00936889648437500, 0.00119018554687500, 0.00366210937500000, 0.00204467773437500, 0.00140380859375000, 0.00939941406250000, 0.0303649902343750, 0.0625915527343750, 0.0783996582031250, 0.0656738281250000, 0.0224304199218750, -0.0308837890625000, -0.0737915039062500, -0.0892028808593750, -0.0770263671875000, -0.0558776855468750, -0.0338745117187500, -0.0182800292968750, -0.00875854492187500, -0.00225830078125000, -0.000335693359375000, 0.0119628906250000, 0.0372924804687500, 0.0514831542968750, 0.0474243164062500, 0.0305480957031250, 0.0127258300781250, -0.000518798828125000, -0.00500488281250000, -0.0109863281250000, -0.0154724121093750, -0.0127868652343750, -0.0176391601562500, -0.0270080566406250, -0.0378112792968750, -0.0338439941406250, -0.0146179199218750, 0.00653076171875000, 0.0231933593750000, 0.0285339355468750, 0.0287170410156250, 0.0251159667968750, 0.0193481445312500, 0.0148620605468750, 0.0179443359375000, 0.0229492187500000, 0.0214843750000000, 0.0178222656250000, 0.0113220214843750, 0.00909423828125000, 0.00558471679687500, -0.00973510742187500, -0.0237121582031250, -0.0299377441406250, -0.0222167968750000, -0.0121765136718750, -0.0107727050781250, -0.00543212890625000, 0.0138854980468750, 0.0415649414062500, 0.0511474609375000, 0.0481567382812500, 0.0411376953125000, 0.0342712402343750, 0.0378112792968750, 0.0308532714843750, 0.0111999511718750, -0.00994873046875000, -0.0208435058593750, -0.0224609375000000, -0.0232849121093750, -0.0266723632812500, -0.0343933105468750, -0.0243530273437500, -0.000335693359375000, 0.0193176269531250, 0.0262451171875000, 0.0277404785156250, 0.0404052734375000, 0.0514526367187500, 0.0498962402343750, 0.0377197265625000, 0.0198669433593750, 0.00885009765625000, -0.00735473632812500, -0.0279846191406250, -0.0361938476562500, -0.0348205566406250, -0.0319213867187500, -0.0242614746093750, -0.00772094726562500, -0.00137329101562500, 0.000518798828125000, 0.00735473632812500, 0.0168762207031250, 0.0302124023437500, 0.0301208496093750, 0.0258483886718750, 0.0256347656250000, 0.0235900878906250, 0.00619506835937500, -0.0202026367187500, -0.0230712890625000, -0.0147399902343750, -0.0128173828125000, -0.0101623535156250, -0.00534057617187500, -0.00585937500000000, -0.00820922851562500, -0.00448608398437500, -0.00402832031250000, -0.000335693359375000, 0.000213623046875000, 0.00418090820312500, 0.0227661132812500, 0.0224304199218750, 0.00704956054687500, 0.00277709960937500, 0.0179443359375000, 0.0175170898437500, -0.00311279296875000, -0.00781250000000000, -0.00225830078125000, 0.00524902343750000, -0.00128173828125000, -0.00885009765625000, -0.00878906250000000, -0.00427246093750000, -0.000762939453125000, -0.0133666992187500, -0.0151672363281250, -0.00607299804687500, 0.0130310058593750, 0.0324707031250000, 0.0340881347656250, 0.0329895019531250, 0.0320434570312500, 0.0277709960937500, 0.0176391601562500, 0.00665283203125000, -0.00238037109375000, -0.00814819335937500, -0.00765991210937500, -0.0153808593750000, -0.0214843750000000, -0.0156860351562500, -0.00961303710937500, 0.00192260742187500, 0.0158081054687500, 0.0236816406250000, 0.0306396484375000, 0.0406799316406250, 0.0364074707031250, 0.0173950195312500, 0.0109863281250000, 0.0175170898437500, 0.0189208984375000, 0.0126037597656250, 0.00534057617187500, -0.00119018554687500, -0.00320434570312500, -0.00195312500000000, -0.00674438476562500, -0.0110778808593750, -0.00280761718750000, 0.0119628906250000, 0.0232849121093750, 0.0261535644531250, 0.0166625976562500, 0.0100402832031250, 0.0172119140625000, 0.0221252441406250, 0.0121765136718750, 0.00415039062500000, 0.00653076171875000, 0.0107116699218750, 0.00473022460937500, -0.0115356445312500, -0.0133361816406250, -0.0119628906250000, -0.0523376464843750, -0.123901367187500, -0.154876708984375, -0.129364013671875, -0.0964355468750000, -0.0664367675781250, 0.00451660156250000, 0.110137939453125, 0.192169189453125, 0.209381103515625, 0.153594970703125, 0.0749816894531250, 0.0142211914062500, -0.0226440429687500, -0.0545959472656250, -0.0812683105468750, -0.0859985351562500, -0.0811767578125000, -0.0813903808593750, -0.113128662109375, -0.137878417968750, -0.121215820312500, -0.0640869140625000, 0.0288391113281250, 0.101470947265625, 0.108215332031250, 0.0379333496093750, -0.0574645996093750, -0.124542236328125, -0.156585693359375, -0.159271240234375, -0.117706298828125, -0.0204162597656250, 0.0667724609375000, 0.0847167968750000, 0.0371704101562500, -0.0158996582031250, -0.0246582031250000, -0.000518798828125000, 0.0448608398437500, 0.0860900878906250, 0.0985107421875000, 0.0582275390625000, -0.0224304199218750, -0.101593017578125, -0.147186279296875, -0.122619628906250, -0.0370483398437500, 0.0862731933593750, 0.175811767578125, 0.185638427734375, 0.160552978515625, 0.142791748046875, 0.124114990234375, 0.0930480957031250, 0.0765991210937500, 0.0728454589843750, 0.0529785156250000, -0.00170898437500000, -0.0596008300781250, -0.0779113769531250, -0.0500793457031250, 0.00833129882812500, 0.0727539062500000, 0.124877929687500, 0.148254394531250, 0.133605957031250, 0.106597900390625, 0.0896301269531250, 0.0794982910156250, 0.0958251953125000, 0.126068115234375, 0.136199951171875, 0.112060546875000, 0.0767822265625000, 0.0357666015625000, 0.000640869140625000, -0.0124206542968750, -0.0109863281250000, 0.0239257812500000, 0.0604553222656250, 0.0787963867187500, 0.0623779296875000, 0.0365295410156250, 0.0328979492187500, 0.0310668945312500, 0.0395202636718750, 0.0533142089843750, 0.0808715820312500, 0.107025146484375, 0.119415283203125, 0.101928710937500, 0.0639953613281250, 0.0443420410156250, 0.0317382812500000, 0.0165405273437500, 0.00103759765625000, -0.00555419921875000, -0.00289916992187500, -0.00354003906250000, -0.00927734375000000, -0.00814819335937500, 0.0113220214843750, 0.0512695312500000, 0.0830993652343750, 0.101501464843750, 0.110229492187500, 0.0959472656250000, 0.0732421875000000, 0.0455932617187500, 0.0180358886718750, 0.00640869140625000, 0.0103759765625000, 0.0109863281250000, 0.00128173828125000, -0.0302429199218750, -0.0783081054687500, -0.0868530273437500, -0.0592956542968750, -0.0316467285156250, 0.0174255371093750, 0.0759582519531250, 0.0920715332031250, 0.0722961425781250, 0.0490417480468750, 0.0217895507812500, -0.0245666503906250, -0.0527648925781250, -0.0337524414062500, -0.000427246093750000, 0.0137634277343750, -0.0241088867187500, -0.0682373046875000, -0.0531005859375000, -0.0144042968750000, -0.0114135742187500, -0.0202636718750000, 0.00534057617187500, 0.0143127441406250, -0.0255126953125000, -0.123809814453125, -0.259124755859375, -0.312652587890625, -0.274719238281250, -0.254425048828125, -0.260711669921875, -0.213745117187500, -0.112457275390625, -0.0410156250000000, -0.0515747070312500, -0.0934753417968750, -0.0932617187500000, -0.0756530761718750, -0.0907897949218750, -0.147186279296875, -0.208923339843750, -0.257659912109375, -0.302490234375000, -0.342376708984375, -0.358581542968750, -0.337341308593750, -0.280395507812500, -0.185211181640625, -0.108520507812500, -0.0923156738281250, -0.110015869140625, -0.115356445312500, -0.104492187500000, -0.116241455078125, -0.140808105468750, -0.132904052734375, -0.118560791015625, -0.143768310546875, -0.185760498046875, -0.220031738281250, -0.223571777343750, -0.199005126953125, -0.168457031250000, -0.133209228515625, -0.0800170898437500, -0.0299072265625000, -0.00479125976562500, 0.00482177734375000, -0.0175170898437500, -0.0455017089843750, -0.0390930175781250, -0.00738525390625000, 0.00778198242187500, -0.000976562500000000, 0.0220947265625000, 0.0639953613281250, 0.0715637207031250, 0.0407104492187500, 0.0106811523437500, 0.0196228027343750, 0.0514831542968750, 0.0583190917968750, 0.0477600097656250, 0.0466003417968750, 0.0519104003906250, 0.0584411621093750, 0.0627136230468750, 0.0751953125000000, 0.115570068359375, 0.168884277343750, 0.190582275390625, 0.185516357421875, 0.177307128906250, 0.162994384765625, 0.145355224609375, 0.135223388671875, 0.132141113281250, 0.143554687500000, 0.157989501953125, 0.139190673828125, 0.0977172851562500, 0.0870666503906250, 0.115783691406250, 0.139282226562500, 0.172851562500000, 0.202636718750000, 0.220031738281250, 0.237915039062500, 0.229766845703125, 0.190429687500000, 0.156494140625000, 0.171661376953125, 0.178588867187500, 0.163116455078125, 0.135223388671875, 0.0974121093750000, 0.0865478515625000, 0.0896301269531250, 0.0816955566406250, 0.0798950195312500, 0.120391845703125, 0.156372070312500, 0.148468017578125, 0.127410888671875, 0.113189697265625, 0.0991516113281250, 0.0939025878906250, 0.0912170410156250, 0.0872497558593750, 0.0850524902343750, 0.0775451660156250, 0.0586547851562500, 0.0198364257812500, 0.00402832031250000, 0.00738525390625000, 0.0268249511718750, 0.0400695800781250, 0.0252075195312500, 0.0170898437500000, 0.0206298828125000, 0.0249938964843750, 0.00375366210937500, -0.00765991210937500, 0.00640869140625000, 0.0303649902343750, 0.0277709960937500, -0.000854492187500000, -0.0123596191406250, -0.00863647460937500, 0.00628662109375000, 0.00653076171875000, -0.00140380859375000, -0.000946044921875000, 0.00833129882812500, 0.00140380859375000, -0.0252990722656250, -0.0469055175781250, -0.0370483398437500, 0.00234985351562500, 0.0148315429687500, -0.000640869140625000, -0.00524902343750000, 0.0146179199218750, 0.0268249511718750, 0.0187988281250000, 0.0117492675781250, 0.0290222167968750, 0.0546875000000000, 0.0584411621093750, 0.0384521484375000, 0.0180664062500000, 0.0293884277343750, 0.0353393554687500, 0.0215759277343750, 0.00640869140625000, 0.0170898437500000, 0.0394287109375000, 0.0497741699218750, 0.0602416992187500, 0.0773315429687500, 0.113342285156250, 0.126800537109375, 0.124328613281250, 0.117279052734375, 0.107238769531250, 0.102966308593750, 0.0917663574218750, 0.0868530273437500, 0.0632629394531250, 0.0434570312500000, 0.0672912597656250, 0.107238769531250, 0.109375000000000, 0.0778808593750000, 0.0949707031250000, 0.142517089843750, 0.137237548828125, 0.0917358398437500, 0.0666503906250000, 0.0840759277343750, 0.102661132812500, 0.0888671875000000, 0.0657958984375000, 0.0615234375000000, 0.0769042968750000, 0.0817260742187500, 0.0760498046875000, 0.0584106445312500, 0.0331420898437500, 0.0314941406250000, 0.0290527343750000, -0.00756835937500000, -0.0624694824218750, -0.0817260742187500, -0.0732421875000000, -0.0870361328125000, -0.105010986328125, -0.0886535644531250, -0.0553283691406250, -0.0326843261718750, -0.0480651855468750, -0.0858764648437500, -0.0930175781250000, -0.101593017578125, -0.147644042968750, -0.195678710937500, -0.198577880859375, -0.182037353515625, -0.175933837890625, -0.199096679687500, -0.245574951171875, -0.275909423828125, -0.274963378906250, -0.257141113281250, -0.273651123046875, -0.293029785156250, -0.271026611328125, -0.223999023437500, -0.207153320312500, -0.247070312500000, -0.284240722656250, -0.263854980468750, -0.226135253906250, -0.249725341796875, -0.305084228515625, -0.327514648437500, -0.295562744140625, -0.237670898437500, -0.240142822265625, -0.298767089843750, -0.292694091796875, -0.224304199218750, -0.198577880859375, -0.246124267578125, -0.264282226562500, -0.211700439453125, -0.154571533203125, -0.122528076171875, -0.118041992187500, -0.108337402343750, -0.100921630859375, -0.0945129394531250, -0.113098144531250, -0.171447753906250, -0.207855224609375, -0.187896728515625, -0.114837646484375, -0.0465698242187500, -0.0177307128906250, 0.0114135742187500, 0.0429382324218750, 0.0487365722656250, 0.0176391601562500, -0.0195312500000000, 0.00427246093750000, 0.0504455566406250, 0.0942993164062500, 0.119964599609375, 0.108398437500000, 0.102874755859375, 0.100494384765625, 0.100494384765625, 0.0783691406250000, 0.0784912109375000, 0.136199951171875, 0.179321289062500, 0.188873291015625, 0.182647705078125, 0.184692382812500, 0.199615478515625, 0.192260742187500, 0.174316406250000, 0.171691894531250, 0.201568603515625, 0.230407714843750, 0.219848632812500, 0.190246582031250, 0.153381347656250, 0.143890380859375, 0.149963378906250, 0.164520263671875, 0.197509765625000, 0.238861083984375, 0.280609130859375, 0.277954101562500, 0.230194091796875, 0.184143066406250, 0.172637939453125, 0.204010009765625, 0.227081298828125, 0.217376708984375, 0.215789794921875, 0.196411132812500, 0.141113281250000, 0.0764770507812500, 0.0539245605468750, 0.0773010253906250, 0.115814208984375, 0.165679931640625, 0.187042236328125, 0.185974121093750, 0.158447265625000, 0.117492675781250, 0.0934753417968750, 0.0783996582031250, 0.0840759277343750, 0.0841369628906250, 0.0773315429687500, 0.0585021972656250, 0.0249938964843750, -0.00299072265625000, -0.0207214355468750, -0.0120849609375000, 0.00405883789062500, 0.0126037597656250, 0.0179443359375000, 0.0244750976562500, 0.0151672363281250, -0.0191345214843750, -0.0457153320312500, -0.0340576171875000, -0.00491333007812500, -0.000427246093750000, -0.0243530273437500, -0.0445556640625000, -0.0422973632812500, -0.0530700683593750, -0.0902709960937500, -0.115020751953125, -0.0769958496093750, -0.0315246582031250, -0.0371704101562500, -0.0633239746093750, -0.0792541503906250, -0.0779418945312500, -0.0803527832031250, -0.0795593261718750, -0.0659179687500000, -0.0395202636718750, -0.0242614746093750, -0.0257263183593750, -0.0308532714843750, -0.0437011718750000, -0.0582275390625000, -0.0557556152343750, -0.0307617187500000, -0.0236206054687500, -0.0384521484375000, -0.0489196777343750, -0.0469970703125000, -0.0490417480468750, -0.0502014160156250, -0.0432434082031250, -0.0252990722656250, 0.00747680664062500, 0.0287475585937500, 0.0424194335937500, 0.0455932617187500, 0.0486145019531250, 0.0575561523437500, 0.0568542480468750, 0.0513916015625000, 0.0432739257812500, 0.0531005859375000, 0.0604553222656250, 0.0416564941406250, 0.0239257812500000, 0.0214843750000000, 0.0476379394531250, 0.0732727050781250, 0.0936889648437500, 0.126251220703125, 0.148986816406250, 0.154144287109375, 0.132659912109375, 0.105316162109375, 0.0816345214843750, 0.0927429199218750, 0.135772705078125, 0.135559082031250, 0.0931701660156250, 0.0572509765625000, 0.0576782226562500, 0.0470886230468750, 0.00939941406250000, 0.0202636718750000, 0.0778503417968750, 0.119201660156250, 0.104827880859375, 0.0612182617187500, 0.0422973632812500, 0.0414428710937500, 0.0441284179687500, 0.0600280761718750, 0.0998840332031250, 0.125732421875000, 0.0821228027343750, 0.0196228027343750, -0.0316162109375000, -0.0765075683593750, -0.0903625488281250, -0.0746765136718750, -0.0324401855468750, -0.0179443359375000, -0.00354003906250000, -0.0178527832031250, -0.0920715332031250, -0.140808105468750, -0.143432617187500, -0.100402832031250, -0.0867309570312500, -0.0733947753906250, -0.0518493652343750, -0.0666198730468750, -0.0969848632812500, -0.171539306640625, -0.222503662109375, -0.218536376953125, -0.222290039062500, -0.240875244140625, -0.232421875000000, -0.198242187500000, -0.207000732421875, -0.250915527343750, -0.262573242187500, -0.283843994140625, -0.291717529296875, -0.278228759765625, -0.263214111328125, -0.232543945312500, -0.208007812500000, -0.180419921875000, -0.212677001953125, -0.239715576171875, -0.266082763671875, -0.295867919921875, -0.288391113281250, -0.289886474609375, -0.278900146484375, -0.261474609375000, -0.236083984375000, -0.248687744140625, -0.279663085937500, -0.263397216796875, -0.182678222656250, -0.113006591796875, -0.101715087890625, -0.109832763671875, -0.0928344726562500, -0.0825805664062500, -0.126770019531250, -0.162872314453125, -0.146148681640625, -0.0620727539062500, -0.0185852050781250, -0.0221862792968750, -0.0568237304687500, -0.105010986328125, -0.106933593750000, -0.0822448730468750, -0.0328063964843750, 0.00448608398437500, 0.0603332519531250, 0.112060546875000, 0.122741699218750, 0.0760803222656250, 0.0435791015625000, 0.0783081054687500, 0.112152099609375, 0.122741699218750, 0.110656738281250, 0.129455566406250, 0.130004882812500, 0.0929260253906250, 0.0635681152343750, 0.0884704589843750, 0.149505615234375, 0.180816650390625, 0.170288085937500, 0.131378173828125, 0.125732421875000, 0.128936767578125, 0.133941650390625, 0.152221679687500, 0.186492919921875, 0.231689453125000, 0.271636962890625, 0.275207519531250, 0.235870361328125, 0.203369140625000, 0.177947998046875, 0.173065185546875, 0.159820556640625, 0.146759033203125, 0.145629882812500, 0.162139892578125, 0.183288574218750, 0.171691894531250, 0.161621093750000, 0.149322509765625, 0.144927978515625, 0.146240234375000, 0.164703369140625, 0.181671142578125, 0.186309814453125, 0.196563720703125, 0.185638427734375, 0.162048339843750, 0.122924804687500, 0.0809631347656250, 0.0618286132812500, 0.0588684082031250, 0.0423889160156250, 0.0278625488281250, 0.0337524414062500, 0.0362243652343750, 0.0350341796875000, 0.0426025390625000, 0.0489196777343750, 0.0474243164062500, 0.0378112792968750, 0.00949096679687500, -0.0119628906250000, -0.00717163085937500, -0.00329589843750000, -0.00738525390625000, 0.00610351562500000, 0.0252075195312500, 0.00564575195312500, -0.0514831542968750, -0.0993347167968750, -0.114196777343750, -0.0972290039062500, -0.0776672363281250, -0.0656127929687500, -0.0449829101562500, -0.0318298339843750, -0.0352783203125000, -0.0513610839843750, -0.0675964355468750, -0.0681457519531250, -0.0313720703125000, 0.0104675292968750, 0.00457763671875000, -0.0307922363281250, -0.0491333007812500, -0.0586242675781250, -0.0749816894531250, -0.0739135742187500, -0.0521240234375000, -0.0246887207031250, -0.0100402832031250, -0.0228576660156250, -0.0493469238281250, -0.0569458007812500, -0.0382385253906250, -0.00503540039062500, 0.0398559570312500, 0.0718078613281250, 0.0830078125000000, 0.0741271972656250, 0.0552062988281250, 0.0283203125000000, 0.00778198242187500, 0.0289306640625000, 0.0622863769531250, 0.0849304199218750, 0.0941162109375000, 0.0910034179687500, 0.0773315429687500, 0.0639038085937500, 0.0683593750000000, 0.0779113769531250, 0.0952758789062500, 0.124114990234375, 0.157775878906250, 0.176330566406250, 0.170928955078125, 0.161499023437500, 0.159790039062500, 0.163238525390625, 0.158294677734375, 0.143127441406250, 0.132995605468750, 0.112152099609375, 0.0875854492187500, 0.0976562500000000, 0.100738525390625, 0.0746765136718750, 0.0665283203125000, 0.0993652343750000};
        
        for(int c = 0; c<m_iNumberOfChannels; c++){
            for (int f=0; f<m_iNumFrames; f++){
                m_ppfInputBuffer[c][f] = fAudioBuff[f];
            }
        }
        
        m_pCPpm->init(m_fSampleRateHz, m_iNumberOfChannels, m_fAttackTime, m_fReleaseTime);
        m_pCPpm->process((const float**)m_ppfInputBuffer, m_iNumFrames);
        
        CHECK_CLOSE(0.1473F, m_pCPpm->getMaxPpm(), 0.005);
        
    }
    

}

#endif //WITH_TESTS